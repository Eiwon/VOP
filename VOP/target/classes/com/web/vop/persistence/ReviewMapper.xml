<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.web.vop.persistence.ReviewMapper">

	<resultMap type="com.web.vop.domain.ReviewVO"
      id="reviewResultMap">
      
      <id property="reviewId" column="REVIEW_ID" /> 
      <result property="memberId" column="MEMBER_ID" />
      <result property="productId" column="PRODUCT_ID" />
      <result property="reviewContent" column="REVIEW_CONTENT" />
      <result property="reviewDateCreated" column="REVIEW_DATE_CREATED" />
      <result property="reviewStar" column="REVIEW_STAR"/>
      <result property="reviewLike" column="REVIEW_LIKE"/>
      <result property="imgId" column="IMG_ID"/>
      
      </resultMap>
   
   <!-- 댓글(리뷰) 입력 -->
   <insert id="insertReview">
      INSERT INTO REVIEW (REVIEW_ID, MEMBER_ID, PRODUCT_ID, REVIEW_CONTENT
      , REVIEW_DATE_CREATED, REVIEW_STAR, REVIEW_LIKE)
      VALUES (REVIEW_SEQ.NEXTVAL, #{memberId}, #{productId}, #{reviewContent}
      , SYSDATE, #{reviewStar}, 0)<!-- 0 좋아요는 댓글 작성 하는 사람 이외 다른 사람이 수정 해야 한다. -->
   </insert>
   
   <!-- 댓글(리뷰) productId 그리고 memberId통해 검색 -->
   <select id="selectByReview" resultMap="reviewResultMap">
   		SELECT * FROM REVIEW
	 	WHERE PRODUCT_ID = #{productId} AND MEMBER_ID = #{memberId}
   </select>
   
   <!-- 댓글(리뷰) 전체 검색 -->
   <select id="selectListByReview" resultMap="reviewResultMap">
      SELECT * FROM REVIEW
      WHERE PRODUCT_ID = #{productId}
      ORDER BY REVIEW_ID
   </select>
   
   <!-- 댓글(리뷰) 상세 검색(제작 예정) -->
   
   
   <!-- 댓글(리뷰) 수정 -->
   <update id="updateReview">
      UPDATE REVIEW
      SET REVIEW_CONTENT = #{reviewContent},
      REVIEW_STAR = #{reviewStar}
      WHERE REVIEW_ID = #{productId} AND #{memberId}
   </update>
   
   <!-- 댓글(리뷰) 삭제 -->
   <delete id="deleteReview">
      DELETE FROM REVIEW 
      WHERE REVIEW_ID = #{productId} AND #{memberId}
   </delete>
   
   <!-- 상품 총 댓글 수 증가 -->
	<update id="reviewNumUP">
		UPDATE PRODUCT SET REVIEW_NUM = REVIEW_NUM + 1
		WHERE PRODUCT_ID = #{productId}
	</update>
	
	<!-- 상품 총 댓글 수 감소 -->
	<update id="reviewNumDown">
		UPDATE PRODUCT SET REVIEW_NUM = REVIEW_NUM - 1
		WHERE PRODUCT_ID = #{productId}
	</update>
   
    
    
</mapper>