<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.web.vop.persistence.OrderMapper">

   <resultMap type="com.web.vop.domain.OrderVO"
      id="OrderResultMap">
      
      <id property="orderId" column="ORDER_ID" /> 
      <result property="paymentId" column="PAYMENT_ID" />
      <result property="productId" column="PRODUCT_ID"/>
      <result property="productName" column="PRODUCT_NAME"/>
      <result property="productPrice" column="PRODUCT_PRICE"/>
      <result property="purchaseNum" column="PURCHASE_NUM"/>
      <result property="expectDeliveryDate" column="EXPECT_DELIVERY_DATE"/>
      <result property="imgId" column="IMG_ID"/>
<<<<<<< HEAD
      <result property="memberId" column="MEMBER_ID"/> <!-- memberId 추가 하기 -->
=======
      <result property="member_id" column="MEMBER_ID"/>

>>>>>>> 0d996a6246facfcd9fb033cc5a67cd9ba9379427
   </resultMap>

	<resultMap type="com.web.vop.domain.DeliveryVO" id="DeliveryResultMap">
      <id property="deliveryId" column="DELIVERY_ID" /> 
      <result property="memberId" column="MEMBER_ID"/>
      <result property="receiverName" column="RECEIVER_NAME"/>
      <result property="receiverAddress" column="RECEIVER_ADDRESS"/>
      <result property="receiverPhone" column="RECEIVER_PHONE"/>
      <result property="deliveryAddressDetails" column="DELIVERY_ADDRESS_DETAILS"/>
      <result property="requirement" column="REQUIREMENT"/>
   </resultMap>
   
	<!-- 배송지 상세 조회 (배송 예정일) -->
	<select id="selectByExpectDeliveryDate" resultType="Date">
		SELECT EXPECT_DELIVERY_DATE FROM "ORDER" WHERE PAYMENT_ID = #{paymentId}
	</select>

	<!-- 배송지 상세 조회 (송장 번호)  -->
	<select id="selectByPaymentId" resultType="Integer">
	SELECT PAYMENT_ID FROM "ORDER" WHERE PAYMENT_ID = #{paymentId}
	</select>
	
	<!-- 주문 등록 -->
	<insert id="insertOrder">
		INSERT INTO "ORDER" VALUES (
			ORDER_SEQ.NEXTVAL, #{paymentId}, #{productId}, #{productName}, #{productPrice}, #{purchaseNum},
			SYSDATE +2, #{imgId}, #{memberId}
		)
	</insert>
	
	
	<!-- paymentId로 주문 검색 -->
	<select id="selectOrderByPaymentId" resultMap="OrderResultMap">
		SELECT * FROM "ORDER" WHERE PAYMENT_ID = #{paymentId}
	</select>
	
	<!--  배송지 상세 조회 -->
	<select id="selectByMemberId" resultMap="DeliveryResultMap">
		SELECT * FROM DELIVERY WHERE MEMBER_ID = #{memberId}
	</select>
	
	
	<!-- 배송지 등록  -->
	<insert id="insertDelivery">
		INSERT INTO DELIVERY VALUES (
		#{deliveryId}, #{memberId}, #{receiverName}, #{receiverAddress}, #{receiverPhone}, #{requirement})
	</insert>
	
	<!-- 배송지 수정  -->
	<update id="updateDelivery">
		UPDATE DELIVERY SET RECEIVER_NAME = #{receiverName}, RECEIVER_ADDRESS = #{receiverAddress}, 
		RECEIVER_PHONE = #{receiverPhone} , DELIVERY_ADDRESS_DETAILS = #{deliveryAddressDetails}, REQUIREMENT = #{requirement}
		WHERE MEMBER_ID = #{memberId}
	</update>
	
	<!-- 배송지 삭제 -->
	<delete id="deleteDelivery">
		DELETE DELIVERY WHERE MEMBER_ID = #{memberId}
	</delete>
	
	<!-- 주문 목록 조회 -->
	<select id="selectOrderListByMemberId" resultMap="OrderResultMap">
		SELECT * FROM "ORDER" WHERE MEMBER_ID = #{memberId}
	</select>
	
	
</mapper>